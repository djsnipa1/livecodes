var Q=Object.create;var E=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var te=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var re=(e,r,p,u)=>{if(r&&typeof r=="object"||typeof r=="function")for(let f of X(r))!ee.call(e,f)&&f!==p&&E(e,f,{get:()=>r[f],enumerable:!(u=V(r,f))||u.enumerable});return e};var oe=(e,r,p)=>(p=e!=null?Q(Y(e)):{},re(r||!e||!e.__esModule?E(p,"default",{value:e,enumerable:!0}):p,e));var H=te((tt,k)=>{var K=function(){var e=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",u={};function f(o,t){if(!u[o]){u[o]={};for(var a=0;a<o.length;a++)u[o][o.charAt(a)]=a}return u[o][t]}var g={compressToBase64:function(o){if(o==null)return"";var t=g._compress(o,6,function(a){return r.charAt(a)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:g._decompress(o.length,32,function(t){return f(r,o.charAt(t))})},compressToUTF16:function(o){return o==null?"":g._compress(o,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:g._decompress(o.length,16384,function(t){return o.charCodeAt(t)-32})},compressToUint8Array:function(o){for(var t=g.compress(o),a=new Uint8Array(t.length*2),i=0,l=t.length;i<l;i++){var y=t.charCodeAt(i);a[i*2]=y>>>8,a[i*2+1]=y%256}return a},decompressFromUint8Array:function(o){if(o==null)return g.decompress(o);for(var t=new Array(o.length/2),a=0,i=t.length;a<i;a++)t[a]=o[a*2]*256+o[a*2+1];var l=[];return t.forEach(function(y){l.push(e(y))}),g.decompress(l.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":g._compress(o,6,function(t){return p.charAt(t)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),g._decompress(o.length,32,function(t){return f(p,o.charAt(t))}))},compress:function(o){return g._compress(o,16,function(t){return e(t)})},_compress:function(o,t,a){if(o==null)return"";var i,l,y={},w={},v="",U="",h="",b=2,j=3,d=2,m=[],s=0,n=0,x;for(x=0;x<o.length;x+=1)if(v=o.charAt(x),Object.prototype.hasOwnProperty.call(y,v)||(y[v]=j++,w[v]=!0),U=h+v,Object.prototype.hasOwnProperty.call(y,U))h=U;else{if(Object.prototype.hasOwnProperty.call(w,h)){if(h.charCodeAt(0)<256){for(i=0;i<d;i++)s=s<<1,n==t-1?(n=0,m.push(a(s)),s=0):n++;for(l=h.charCodeAt(0),i=0;i<8;i++)s=s<<1|l&1,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=l>>1}else{for(l=1,i=0;i<d;i++)s=s<<1|l,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=0;for(l=h.charCodeAt(0),i=0;i<16;i++)s=s<<1|l&1,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=l>>1}b--,b==0&&(b=Math.pow(2,d),d++),delete w[h]}else for(l=y[h],i=0;i<d;i++)s=s<<1|l&1,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=l>>1;b--,b==0&&(b=Math.pow(2,d),d++),y[U]=j++,h=String(v)}if(h!==""){if(Object.prototype.hasOwnProperty.call(w,h)){if(h.charCodeAt(0)<256){for(i=0;i<d;i++)s=s<<1,n==t-1?(n=0,m.push(a(s)),s=0):n++;for(l=h.charCodeAt(0),i=0;i<8;i++)s=s<<1|l&1,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=l>>1}else{for(l=1,i=0;i<d;i++)s=s<<1|l,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=0;for(l=h.charCodeAt(0),i=0;i<16;i++)s=s<<1|l&1,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=l>>1}b--,b==0&&(b=Math.pow(2,d),d++),delete w[h]}else for(l=y[h],i=0;i<d;i++)s=s<<1|l&1,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=l>>1;b--,b==0&&(b=Math.pow(2,d),d++)}for(l=2,i=0;i<d;i++)s=s<<1|l&1,n==t-1?(n=0,m.push(a(s)),s=0):n++,l=l>>1;for(;;)if(s=s<<1,n==t-1){m.push(a(s));break}else n++;return m.join("")},decompress:function(o){return o==null?"":o==""?null:g._decompress(o.length,32768,function(t){return o.charCodeAt(t)})},_decompress:function(o,t,a){var i=[],l,y=4,w=4,v=3,U="",h=[],b,j,d,m,s,n,x,c={val:a(0),position:t,index:1};for(b=0;b<3;b+=1)i[b]=b;for(d=0,s=Math.pow(2,2),n=1;n!=s;)m=c.val&c.position,c.position>>=1,c.position==0&&(c.position=t,c.val=a(c.index++)),d|=(m>0?1:0)*n,n<<=1;switch(l=d){case 0:for(d=0,s=Math.pow(2,8),n=1;n!=s;)m=c.val&c.position,c.position>>=1,c.position==0&&(c.position=t,c.val=a(c.index++)),d|=(m>0?1:0)*n,n<<=1;x=e(d);break;case 1:for(d=0,s=Math.pow(2,16),n=1;n!=s;)m=c.val&c.position,c.position>>=1,c.position==0&&(c.position=t,c.val=a(c.index++)),d|=(m>0?1:0)*n,n<<=1;x=e(d);break;case 2:return""}for(i[3]=x,j=x,h.push(x);;){if(c.index>o)return"";for(d=0,s=Math.pow(2,v),n=1;n!=s;)m=c.val&c.position,c.position>>=1,c.position==0&&(c.position=t,c.val=a(c.index++)),d|=(m>0?1:0)*n,n<<=1;switch(x=d){case 0:for(d=0,s=Math.pow(2,8),n=1;n!=s;)m=c.val&c.position,c.position>>=1,c.position==0&&(c.position=t,c.val=a(c.index++)),d|=(m>0?1:0)*n,n<<=1;i[w++]=e(d),x=w-1,y--;break;case 1:for(d=0,s=Math.pow(2,16),n=1;n!=s;)m=c.val&c.position,c.position>>=1,c.position==0&&(c.position=t,c.val=a(c.index++)),d|=(m>0?1:0)*n,n<<=1;i[w++]=e(d),x=w-1,y--;break;case 2:return h.join("")}if(y==0&&(y=Math.pow(2,v),v++),i[x])U=i[x];else if(x===w)U=j+j.charAt(0);else return null;h.push(U),i[w++]=j+U.charAt(0),y--,j=U,y==0&&(y=Math.pow(2,v),v++)}}};return g}();typeof define=="function"&&define.amd?define(function(){return K}):typeof k<"u"&&k!=null&&(k.exports=K)});var se=e=>!e?.startsWith("http")&&!e?.startsWith("data:"),I=(e,r=document.baseURI)=>se(e)?new URL(e,r).href:e;var A=(e,r)=>new Promise((p,u)=>{if(r&&globalThis[r])return p(globalThis[r]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(e),r&&globalThis[r]?p(globalThis[r]):p(globalThis);let f=document.createElement("script");f.src=e,f.async=!0;let g=()=>{f.removeEventListener("load",o),f.removeEventListener("error",t)},o=()=>{if(g(),!r)return p("loaded: "+e);let a=setInterval(()=>{if(window[r])return clearInterval(a),p(window[r])},5)},t=()=>{g(),u("failed to load: "+e)};f.addEventListener("load",o),f.addEventListener("error",t),document.head.appendChild(f)});var R=["jspm","skypack"],M=["jsdelivr","unpkg","fastly.jsdelivr"],$=["jsdelivr.gh","statically"],S={getModuleUrl:(e,{isModule:r=!0,defaultCDN:p="jspm"}={})=>{e=e.replace(/#nobundle/g,"");let u=P(e,r,p);return u||(r?"https://jspm.dev/"+e:"https://cdn.jsdelivr.net/npm/"+e)},getUrl:(e,r)=>e.startsWith("http")?e:P(e,!1,r||ne())||e,cdnLists:{npm:M,module:R,gh:$},checkCDNs:async(e,r)=>{let p=[r,...S.cdnLists.npm].filter(Boolean);for(let u of p)try{if((await fetch(S.getUrl(e,u),{method:"HEAD"})).ok)return u}catch{}return S.cdnLists.npm[0]}},ne=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||S.cdnLists.npm[0]}catch{return S.cdnLists.npm[0]}},P=(e,r,p)=>{let u=r&&e.startsWith("unpkg:")?"?module":"";e.startsWith("gh:")?e=e.replace("gh",$[0]):e.includes(":")||(e=(p||(r?R[0]:M[0]))+":"+e);for(let f of ie){let[g,o]=f;if(g.test(e))return e.replace(g,o)+u}return null},ie=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://jspm.dev/$2"],[/^(node:)(.+)/i,"https://jspm.dev/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:_,getModuleUrl:ve}=S;var ae="0.6.64",Ue=_(`malinajs@${ae}/malina.js`);var q=_("requirejs@2.3.6/require.js"),O=_("https://cdn.rescript-lang.org/v9.1.2/compiler.js"),W=_("https://cdn.rescript-lang.org/v9.1.2/%40rescript/react/cmij.js"),D=_("@rescript/std@9.1.3/lib/es6/"),B=_("https://cdn.rescript-lang.org/v10.1.2/compiler.js"),N=_("https://cdn.rescript-lang.org/v10.1.2/%40rescript/react/cmij.js"),F=_("@rescript/std@10.1.2/lib/es6/");var C=(e=location.origin)=>!!(e&&(e.endsWith("livecodes.io")||e.endsWith("livecodes.pages.dev")||e.endsWith("localpen.io")||e.endsWith("localpen.pages.dev")||e.startsWith("http://127.0.0.1")||e.startsWith("http://localhost")));var T=oe(H());var J="https://dpaste.com/",le="https://dpaste.com/api/v2/",Z="https://api2.livecodes.io/share",G={getProject:async e=>{try{let r=await fetch(J+e+".txt");return r.ok?JSON.parse(await r.text()):{}}catch{return{}}},shareProject:async e=>{try{let r=await fetch(le,{method:"POST",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":"LiveCodes / https://livecodes.io/"},body:`content=${encodeURIComponent(JSON.stringify(e))}&title=${encodeURIComponent(e.title||"")}&syntax=json&expiry_days=365`});return r.ok?(await r.text()).replace(J,""):""}catch{return""}}},pe={getProject:async e=>{if(e.length<11)return G.getProject(e);if(!C())return{};try{let r=await fetch(Z+"?id="+e);return r.ok?JSON.parse(await r.text()):{}}catch{return{}}},shareProject:async e=>{if(!C())return"";try{let r=await fetch(Z,{method:"POST",mode:"cors",body:JSON.stringify(e)});return r.ok?r.text():""}catch{return""}}},Lt=C()?pe:G;var L=/(import\s+?(?:(?:(?:[\w*\s{},\$]*)\s+from\s+?)|))((?:".*?")|(?:'.*?'))([\s]*?(?:;|$|))/g;var de=(e,r)=>e.replace(new RegExp(L),p=>p.replace(new RegExp(L),"$2").replace(/"/g,"").replace(/'/g,"").startsWith("./stdlib/")?p.replace("./stdlib/",r):p),ue=async e=>(window.require||(await A(q,"require"),window.requirejs.config({waitSeconds:0})),new Promise((r,p)=>{e==="reason"?window.require([O,W],()=>{window.reason_compiler=window.rescript_compiler,window.rescript_compiler=void 0,window.loadedReasonCompiler=window.reason_compiler.make();let u=window.loadedReasonCompiler;u.setModuleSystem("es6"),u.setFilename("index.bs.js"),r()},p):window.require([B,N],()=>{window.rescript_ocaml_compiler=window.rescript_compiler,window.rescript_compiler=void 0,window.loadedRescriptCompiler=window.rescript_ocaml_compiler.make();let u=window.loadedRescriptCompiler;u.setModuleSystem("es6"),u.setFilename("index.bs.js"),r()},p)})),Yt=async(e,{baseUrl:r,language:p})=>{if(!e)return"";let u=p==="reason"?"loadedReasonCompiler":"loadedRescriptCompiler",f=p==="reason"?D:F,g=3;for(;!window[u]&&g>0;)try{await ue(p)}catch{console.warn(`Failed to load ${p} compiler. Retrying...`),g--}let t=window[u][p].compile(e);try{return t.type==="success"&&t.js_code?de(t.js_code,I(f,r)):(t.errors?t.errors.forEach(a=>{console.error(a.fullMsg)}):t.msg&&console.warn(t.msg,t.type),"")}catch(a){return console.error(a),""}};export{Yt as rescriptCompiler};
//# sourceMappingURL=lang-rescript-compiler-esm.js.map
