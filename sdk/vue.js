import{h as V,onMounted as D,onUnmounted as F,ref as J}from"vue";var O=async(r,u={})=>{let{appUrl:g="https://livecodes.io/",params:l={},config:s={},import:c,lite:E=!1,loading:x="lazy",template:H,view:q="split"}=u,o;if(typeof r=="string"?o=document.querySelector(r):o=r,!r)throw new Error("Container element is required.");if(!o)throw new Error(`Cannot find element: "${r}"`);let d;try{d=new URL(g)}catch(e){throw new Error(`"${g}" is not a valid URL.`)}let f=d.origin;if(typeof l=="object"&&Object.keys(l).forEach(e=>{d.searchParams.set(e,String(l[e]))}),typeof s=="string")try{new URL(s),d.searchParams.set("config",s)}catch(e){throw new Error('"config" is not a valid URL or configuration object.')}else if(typeof s=="object")Object.keys(s).length>0&&d.searchParams.set("config","sdk");else throw new Error('"config" is not a valid URL or configuration object.');H&&d.searchParams.set("template",H),c&&d.searchParams.set("x",c),d.searchParams.set(E?"lite":"embed","true"),d.searchParams.set("loading",x),d.searchParams.set("view",q);let h=!1,P="Cannot call API methods after calling `destroy()`.",w=await(()=>new Promise(e=>{var y,L,m,C,p,k,A,T,U;if(!o)return;let n=o.dataset.height||o.style.height;if(n){let M=isNaN(Number(n))?n:n+"px";o.style.height=M}o.dataset.defaultStyles!=="false"&&((y=o.style).backgroundColor||(y.backgroundColor="#fff"),(L=o.style).border||(L.border="1px solid black"),(m=o.style).borderRadius||(m.borderRadius="5px"),(C=o.style).boxSizing||(C.boxSizing="border-box"),(p=o.style).padding||(p.padding="0"),(k=o.style).width||(k.width="100%"),(A=o.style).height||(A.height=o.style.height||"300px"),o.style.minHeight="200px",(T=o.style).overflow||(T.overflow="hidden"),(U=o.style).resize||(U.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let a=x==="eager"?"eager":"lazy";t.setAttribute("loading",a),t.classList.add("livecodes"),t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=o.style.borderRadius,addEventListener("message",function M(S){var N,j;S.source!==t.contentWindow||S.origin!==f||((N=S.data)==null?void 0:N.type)!=="livecodes-get-config"||(removeEventListener("message",M),(j=t.contentWindow)==null||j.postMessage({type:"livecodes-config",payload:s},f))}),t.onload=()=>{e(t)},t.src=d.href,o.innerHTML="",o.appendChild(t)}))(),b=new Promise(e=>{addEventListener("message",function n(t){var a;t.source!==w.contentWindow||t.origin!==f||((a=t.data)==null?void 0:a.type)!=="livecodes-ready"||(removeEventListener("message",n),e(),b.settled=!0)})}),R=()=>h?Promise.reject(P):new Promise(async e=>{var t;b.settled&&e();let n={type:"livecodes-load"};(t=w.contentWindow)==null||t.postMessage(n,f),await b,e()}),i=(e,n)=>new Promise(async(t,a)=>{var y;if(h)return a(P);await R(),addEventListener("message",function L(m){var C;if(!(m.source!==w.contentWindow||m.origin!==f||((C=m.data)==null?void 0:C.type)!=="livecodes-api-response")&&m.data.method===e){removeEventListener("message",L);let p=m.data.payload;p!=null&&p.error?a(p.error):t(p)}}),(y=w.contentWindow)==null||y.postMessage({method:e,args:n},f)}),v=[],z=e=>{if(h)throw new Error(P);return v.push(e),{remove:()=>{v=v.filter(n=>n!==e)}}};addEventListener("message",async e=>{var a;if(e.source!==w.contentWindow||e.origin!==f||((a=e.data)==null?void 0:a.type)!=="livecodes-change")return;let n=await i("getCode"),t=await i("getConfig");v.forEach(y=>{y({code:n,config:t})})});let I=()=>{v.length=0,o&&(o.innerHTML=""),h=!0};return x==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((n,t)=>{n.forEach(async a=>{a.isIntersecting&&(await R(),t.unobserve(o))})},{rootMargin:"150px"}).observe(o),{load:()=>R(),run:()=>i("run"),format:e=>i("format",[e]),getShareUrl:e=>i("getShareUrl",[e]),getConfig:e=>i("getConfig",[e]),setConfig:e=>i("setConfig",[e]),getCode:()=>i("getCode"),show:(e,n)=>i("show",[e,n]),runTests:()=>i("runTests"),onChange:e=>z(e),exec:(e,...n)=>i("exec",[e,...n]),destroy:()=>b.settled?i("destroy").then(I):h?Promise.reject(P):(I(),Promise.resolve())}},W;globalThis.document&&document.currentScript&&"prefill"in((W=document.currentScript)==null?void 0:W.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(r=>{let u,g=r.dataset.options;if(g)try{u=JSON.parse(g)}catch(c){}let l,s=r.dataset.config||r.dataset.prefill;if(s)try{l=JSON.parse(s)}catch(c){}O(r,{import:"dom/"+encodeURIComponent(r.outerHTML),...u,...l?{config:l}:{}})})});var Q={appUrl:String,config:[Object,String],import:String,lite:Boolean,loading:String,params:Object,template:String,view:String,height:String},$={props:Q,emits:["sdkReady"],setup(r,u){let{height:g,...l}=r,s=J(),c;return D(()=>{s.value&&O(s.value,l).then(E=>{c=E,u.emit("sdkReady",E)})}),F(()=>{c==null||c.destroy()}),()=>V("div",{ref:s,"data-height":g})}},Y=$;export{Y as default};
