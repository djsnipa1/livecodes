import{h as Q,onMounted as $,onUnmounted as B,ref as G}from"vue";async function k(s,h={}){typeof s=="object"&&!(s instanceof HTMLElement)&&s.view==="headless"&&(h=s,s=null);let{appUrl:v="https://livecodes.io/",params:y={},config:i={},import:g,lite:P,loading:R="lazy",template:A,view:I="split"}=h,b=I==="headless",o=null;if(typeof s=="string")o=document.querySelector(s);else if(s instanceof HTMLElement)o=s;else if(!(b&&typeof s=="object"))throw new Error("A valid container element is required.");if(!o)if(b)o=document.createElement("div"),j(o),document.body.appendChild(o);else throw new Error(`Cannot find element: "${s}"`);let a;try{a=new URL(v)}catch(e){throw new Error(`"${v}" is not a valid URL.`)}let w=a.origin;if(typeof y=="object"&&Object.keys(y).forEach(e=>{a.searchParams.set(e,String(y[e]))}),typeof i=="string")try{new URL(i),a.searchParams.set("config",i)}catch(e){throw new Error('"config" is not a valid URL or configuration object.')}else if(typeof i=="object")Object.keys(i).length>0&&a.searchParams.set("config","sdk");else throw new Error('"config" is not a valid URL or configuration object.');A&&a.searchParams.set("template",A),g&&a.searchParams.set("x",g),P&&a.searchParams.set("lite","true"),a.searchParams.set("embed","true"),a.searchParams.set("loading",b?"eager":R),a.searchParams.set("view",I);let C=!1,x="Cannot call API methods after calling `destroy()`.",p=await(()=>new Promise(e=>{var l,m,E,c,L,S,u,N,K;if(!o)return;let n=o.dataset.height||o.style.height;if(n&&!b){let H=isNaN(Number(n))?n:n+"px";o.style.height=H}o.dataset.defaultStyles!=="false"&&!b&&((l=o.style).backgroundColor||(l.backgroundColor="#fff"),(m=o.style).border||(m.border="1px solid black"),(E=o.style).borderRadius||(E.borderRadius="5px"),(c=o.style).boxSizing||(c.boxSizing="border-box"),(L=o.style).padding||(L.padding="0"),(S=o.style).width||(S.width="100%"),(u=o.style).height||(u.height=o.style.height||"300px"),o.style.minHeight="200px",o.style.flexGrow="1",(N=o.style).overflow||(N.overflow="hidden"),(K=o.style).resize||(K.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let r=R==="eager"?"eager":"lazy";t.setAttribute("loading",r),t.classList.add("livecodes"),b?j(t):(t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=o.style.borderRadius),addEventListener("message",function H(T){var W,q;T.source!==t.contentWindow||T.origin!==w||((W=T.data)==null?void 0:W.type)!=="livecodes-get-config"||(removeEventListener("message",H),(q=t.contentWindow)==null||q.postMessage({type:"livecodes-config",payload:i},w))}),t.onload=()=>{e(t)},t.src=a.href,o.appendChild(t)}))(),M=new Promise(e=>{addEventListener("message",function n(t){var r;t.source!==p.contentWindow||t.origin!==w||((r=t.data)==null?void 0:r.type)!=="livecodes-ready"||(removeEventListener("message",n),e(),M.settled=!0)})}),O=()=>C?Promise.reject(x):new Promise(async e=>{var t;M.settled&&e();let n={type:"livecodes-load"};(t=p.contentWindow)==null||t.postMessage(n,w),await M,e()}),d=(e,n)=>new Promise(async(t,r)=>{var m;if(C)return r(x);await O();let l=J();addEventListener("message",function E(c){var L,S;if(!(c.source!==p.contentWindow||c.origin!==w||((L=c.data)==null?void 0:L.type)!=="livecodes-api-response"||((S=c.data)==null?void 0:S.id)!==l)&&c.data.method===e){removeEventListener("message",E);let u=c.data.payload;u!=null&&u.error?r(u.error):t(u)}}),(m=p.contentWindow)==null||m.postMessage({method:e,id:l,args:n},w)}),f={},V=["load","ready","code","console","tests","destroy"],U=(e,n)=>{var t;if(C)throw new Error(x);return V.includes(e)?(d("watch",[e]),f[e]||(f[e]=[]),(t=f[e])==null||t.push(n),{remove:()=>{var r,l;f[e]=(r=f[e])==null?void 0:r.filter(m=>m!==n),((l=f[e])==null?void 0:l.length)===0&&d("watch",[e,"unsubscribe"])}}):{remove:()=>{}}},F=e=>({"livecodes-app-loaded":"load","livecodes-ready":"ready","livecodes-change":"code","livecodes-console":"console","livecodes-test-results":"tests","livecodes-destroy":"destroy"})[e];addEventListener("message",async e=>{var r,l,m,E;let n=F((l=(r=e.data)==null?void 0:r.type)!=null?l:"");if(e.source!==p.contentWindow||e.origin!==w||!n||!f[n])return;let t=(m=e.data)==null?void 0:m.payload;(E=f[n])==null||E.forEach(c=>{c(t)})});let D=()=>{var e;Object.values(f).forEach(n=>{n.length=0}),(e=p==null?void 0:p.remove)==null||e.call(p),C=!0};R==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((n,t)=>{n.forEach(async r=>{r.isIntersecting&&(await O(),t.unobserve(o))})},{rootMargin:"150px"}).observe(o);function j(e){e.style.position="absolute",e.style.top="0",e.style.visibility="hidden",e.style.opacity="0"}let J=()=>(String(Math.random())+Date.now().toFixed()).replace("0.","");return{load:()=>O(),run:()=>d("run"),format:e=>d("format",[e]),getShareUrl:e=>d("getShareUrl",[e]),getConfig:e=>d("getConfig",[e]),setConfig:e=>d("setConfig",[e]),getCode:()=>d("getCode"),show:(e,n)=>d("show",[e,n]),runTests:()=>d("runTests"),onChange:e=>U("code",e),watch:U,exec:(e,...n)=>d("exec",[e,...n]),destroy:()=>M.settled?d("destroy").then(D):C?Promise.reject(x):(D(),Promise.resolve())}}var z;globalThis.document&&document.currentScript&&"prefill"in((z=document.currentScript)==null?void 0:z.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(s=>{let h,v=s.dataset.options;if(v)try{h=JSON.parse(v)}catch(P){}let y,i=s.dataset.config||s.dataset.prefill;if(i)try{y=JSON.parse(i)}catch(P){}let g=encodeURIComponent(s.outerHTML);s.innerHTML="",k(s,{import:"dom/"+g,...h,...y?{config:y}:{}})})});var X={appUrl:String,config:[Object,String],import:String,lite:Boolean,loading:String,params:Object,template:String,view:String,height:String},Y={props:X,emits:["sdkReady"],setup(s,h){let{height:v,...y}=s,i=G(),g;return $(()=>{i.value&&k(i.value,y).then(P=>{g=P,h.emit("sdkReady",P)})}),B(()=>{g==null||g.destroy()}),()=>Q("div",{ref:i,"data-height":v})}},oe=Y;export{oe as default};
